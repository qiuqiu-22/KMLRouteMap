<!DOCTYPE html>
<html lang="zh-CN">
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KMLRouteMap</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" />
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
  <script src="https://unpkg.com/leaflet-omnivore@0.3.4/leaflet-omnivore.min.js"></script>
  
  <style>
    /* åœ°å›¾å®¹å™¨ */
	#map {
      width: 100%;
      height: calc(100vh - 100px);
    }
	
	/* é¡µè„šæ ·å¼ */
	footer {
      text-align: center;
      padding: 4px;
      color: #7f8c8d;
      font-size: 1rem;
	  height: 60px;
    }
	
	/* ä¾§è¾¹æ å®¹å™¨ */
	.sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 250px;
      height: 100%;
      background-color: rgba(255, 255, 255, 0.75);
      z-index: 1000;
      padding: 40px;
      box-shadow: 2px 0 5px rgba(0,0,0,0.1);
      transform: translateX(-100%);
      transition: transform 0.3s ease;
    }
	/* ä¾§è¾¹æ å±•å¼€ */
    .sidebar.open {
      transform: translateX(0);
    }
	/* â€œèœå•â€æŒ‰é’® */
    .sidebar-toggle {
      position: fixed;
      left: 10px;
      top: 10px;
      z-index: 1001;
      background: white;
      border: none;
      border-radius: 5px;
      padding: 10px;
      cursor: pointer;
      box-shadow: 0 0 5px rgba(0,0,0,0.2);
	  transition: background-color 0.3s ease;
    }
	/* â€œèœå•â€æŒ‰é’®æ‚¬åœçŠ¶æ€ */
	.sidebar-toggle:hover {
	  background-color: #e0e0e0;
	}
	/* ä¾§è¾¹æ è¡¨å•å…ƒç´  */
    .sidebar label {
      display: block;
      margin: 15px 0 5px;
      font-weight: bold;
    }
	/* ä¾§è¾¹æ ä¸‹æ‹‰æ¡†å…ƒç´  */
    .sidebar select {
      width: 100%;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ddd;
	  margin-bottom: 10px;
    }
	/* â€œæ˜¾ç¤ºå¤©æ°”â€æŒ‰é’® */
	.sidebar button {
	  width: 100%;
	  padding: 8px;
	  background-color: #4CAF50;
      color: white;
	  border-radius: 8px;
      border: none;
      cursor: pointer;
	  margin-bottom: 10px;
	}
	/* â€œæ˜¾ç¤ºå¤©æ°”â€æŒ‰é’®æ‚¬åœçŠ¶æ€ */
	.sidebar button:hover {
      background-color: #45a049;
	}
	/* å¤©æ°”é¢æ¿ */
	#weather-panel {
	  padding: 15px;
	  background-color: white;
	  border-radius: 8px;
	  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
	  border: 1px solid #eee;
	}
	/* å¤©æ°”è¯¦æƒ… */
	#weather-details {
	  margin-top: 10px;
	}
	
	
	/* å¤©æ°”åœ°å›¾æ§åˆ¶é¢æ¿æ ·å¼ */
	.weather-control {
	  background: rgba(255, 255, 255, 0.9);
	  border-radius: 12px;
	  padding: 15px;
	  margin: 15px 0;
	  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
	  backdrop-filter: blur(10px);
	}
	.weather-control h3 {
	  margin: 0 0 15px 0;
	  color: #2c3e50;
	  font-size: 18px;
	  text-align: center;
	  border-bottom: 1px solid #eee;
	  padding-bottom: 10px;
	}
	.weather-map-btn {
	  width: 100%;
	  padding: 12px;
	  background: linear-gradient(135deg, #3498db, #2980b9);
	  color: white;
	  border: none;
	  border-radius: 6px;
	  cursor: pointer;
	  font-size: 16px;
	  margin-bottom: 15px;
	  transition: all 0.3s ease;
	}
	.weather-map-btn:hover {
	  background: linear-gradient(135deg, #2980b9, #3498db);
	  transform: translateY(-2px);
	  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
	}
	.weather-options {
	  display: flex;
	  flex-direction: column;
	  gap: 12px;
	}
	.weather-options label {
	  display: flex;
	  align-items: center;
	  padding: 12px;
	  border-radius: 8px;
	  background: rgba(236, 240, 241, 0.5);
	  cursor: pointer;
	  transition: all 0.3s ease;
	  border: 2px solid transparent;
	}
	.weather-options label:hover {
	  background: rgba(189, 195, 199, 0.5);
	  transform: translateY(-2px);
	  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
	}
	.weather-options label.selected {
	  background: rgba(52, 152, 219, 0.2);
	  border-color: #3498db;
	}
	.weather-options input[type="radio"] {
	  margin-right: 12px;
	  transform: scale(1.2);
	}
	.weather-icon {
	  margin-right: 10px;
	  font-size: 20px;
	  width: 24px;
	  text-align: center;
	}
	.temp-icon { color: #e74c3c; }
	.precip-icon { color: #3498db; }
	.wind-icon { color: #27ae60; }
	
	/* å¤©æ°”å›¾ä¾‹æ ·å¼ */
	.weather-legend {
	  position: absolute;
	  bottom: 20px;
	  right: 20px;
	  background: rgba(255, 255, 255, 0.9);
	  padding: 10px;
	  border-radius: 8px;
	  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
	  z-index: 1000;
	  max-width: 200px;
	}
	.weather-legend h4 {
	  margin: 0 0 8px 0;
	  font-size: 14px;
	  color: #2c3e50;
	}
	.legend-gradient {
	  height: 20px;
	  width: 100%;
	  border-radius: 4px;
	  margin-bottom: 5px;
	}
	.legend-labels {
	  display: flex;
	  justify-content: space-between;
	  font-size: 12px;
	  color: #7f8c8d;
	}
	/* æ¸©åº¦æ¸å˜ */
	.temp-gradient {
	  background: linear-gradient(to right, #313695, #4575b4, #74add1, #abd9e9, #e0f3f8, #ffffcc, #fee090, #fdae61, #f46d43, #d73027, #a50026);
	}
	/* é™æ°´æ¸å˜ */
	.precip-gradient {
	  background: linear-gradient(to right, #ffffff, #c6dbef, #9ecae1, #6baed6, #4292c6, #2171b5, #08519c, #08306b);
	}
	/* é£é€Ÿæ¸å˜ */
	.wind-gradient {
	  background: linear-gradient(to right, #ffffcc, #ffeda0, #fed976, #feb24c, #fd8d3c, #fc4e2a, #e31a1c, #bd0026, #800026);
	}
	
	/* æµ‹è·æ§åˆ¶é¢æ¿æ ·å¼ */
	distance-control {
	  background: rgba(255, 255, 255, 0.9);
	  border-radius: 12px;
	  padding: 15px;
	  margin: 15px 0;
	  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
	  backdrop-filter: blur(10px);
	}
	.distance-control h3 {
	  margin: 0 0 15px 0;
	  color: #2c3e50;
	  font-size: 18px;
	  text-align: center;
	  border-bottom: 1px solid #eee;
	  padding-bottom: 10px;
	}
	.distance-btn {
	  width: 100%;
	  padding: 12px;
	  background: linear-gradient(135deg, #9b59b6, #8e44ad);
	  color: white;
	  border: none;
	  border-radius: 6px;
	  cursor: pointer;
	  font-size: 16px;
	  margin-bottom: 15px;
	  transition: all 0.3s ease;
	}
	.distance-btn:hover {
	  background: linear-gradient(135deg, #8e44ad, #9b59b6);
	  transform: translateY(-2px);
	  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
	}
	#distance-result {
	  background: #f8f9fa;
	  padding: 10px;
	  border-radius: 6px;
	  border-left: 4px solid #9b59b6;
	}
  </style>
</head>

<body>
  <!-- ä¾§è¾¹æ å¼€å…³æŒ‰é’® -->
  <button class="sidebar-toggle" onclick="toggleSidebar()">â˜° èœå•</button>
  
  <!-- ä¾§è¾¹æ å†…å®¹ -->
  <div class="sidebar" id="sidebar">
	<!-- åœ°å›¾ä¸­å¿ƒä½ç½®é€‰æ‹©é¢æ¿ -->
    <label for="center-select">åœ°å›¾ä¸­å¿ƒä½ç½®:</label>
    <select id="center-select" onchange="changeMapCenter()">
      <option value="31.67,119.57,13">æ²³æµ·å¤§å­¦é‡‘å›æ ¡åŒºï¼ˆé»˜è®¤ä¸­å¿ƒï¼‰</option>
      <option value="31.91,118.78,13">æ²³æµ·å¤§å­¦æ±Ÿå®æ ¡åŒº</option>
    </select>
	
	<!-- å¤©æ°”æŒ‰é’®å’Œå¤©æ°”é¢æ¿ -->
	<label for="center-select">åœ°å›¾ä¸­å¿ƒå¤©æ°”:</label>
    <button id="weather-btn" onclick="showWeather()">æ›´æ–°å¤©æ°”</button>
    <div id="weather-panel" style="display: none;">
      <h3>å½“å‰å¤©æ°”</h3>
      <div id="weather-details">ç‚¹å‡»"æ˜¾ç¤ºå¤©æ°”"æŒ‰é’®è·å–æ•°æ®</div>
    </div>
	
	<!-- å¤©æ°”åœ°å›¾æ§åˆ¶æŒ‰é’® -->
	<div class="weather-control">
	  <h3>å¤©æ°”åœ°å›¾æ˜¾ç¤º</h3>
	  <button id="show-weather-map" class="weather-map-btn">æ˜¾ç¤ºå¤©æ°”åœ°å›¾</button>
	  <button id="hide-weather-map" class="weather-map-btn" style="display:none;">éšè—å¤©æ°”åœ°å›¾</button>
	  <div class="weather-options">
		<label class="weather-option">
		  <input type="radio" name="weather-type" value="temperature" checked>
		  <span class="weather-icon temp-icon">ğŸŒ¡ï¸</span>
		  <span>æ¸©åº¦</span>
		</label>
		<label class="weather-option">
		  <input type="radio" name="weather-type" value="precipitation">
		  <span class="weather-icon precip-icon">ğŸ’§</span>
		  <span>é™æ°´</span>
		</label>
		<label class="weather-option">
		  <input type="radio" name="weather-type" value="wind">
		  <span class="weather-icon wind-icon">ğŸ’¨</span>
		  <span>é£é€Ÿ</span>
		</label>
	  </div>
	  
	  <!-- é€æ˜åº¦æ§åˆ¶ -->
	  <div class="weather-opacity-control">
		<label for="opacity-slider">
		  <span class="weather-icon">ğŸ‘ï¸</span>
		  å›¾å±‚é€æ˜åº¦: <span id="opacity-value">70%</span>
		</label>
		<input type="range" id="opacity-slider" min="10" max="100" value="70">
	  </div>
	  
	  <!-- è·ç¦»æµ‹é‡ -->
	  <div class="distance-control">
	    <h3>è·ç¦»æµ‹é‡</h3>
	    <button id="start-measuring" class="distance-btn">å¼€å§‹æµ‹è·</button>
	    <button id="stop-measuring" class="distance-btn" style="display:none;">åœæ­¢æµ‹è·</button>
	    <div id="distance-result" style="display:none; margin-top:10px;">
		  <p><strong>æµ‹é‡è·ç¦»:</strong> <span id="measured-distance">0</span> å…¬é‡Œ</p>
	    </div>
	  </div>
	  
	</div>
  </div>

  <div id="map"></div>
  <footer>
      <p>åŸºäºLeafletå’ŒLeaflet Omnivoreæ¡†æ¶ | å±•ç¤ºKMLéª‘è¡Œè·¯çº¿æ•°æ® | made by qiuqiu</p>
	  <a href="https://github.com/qiuqiu-22/KMLRouteMap" style="color: #7f8c8d;">https://github.com/qiuqiu-22/KMLRouteMap</a>
  </footer>
  <script>
    // 4th Version: V0.2.1 - 1st submission
  
    // åˆå§‹åŒ–åœ°å›¾
    var map = L.map('map', {zoomControl: false}).setView([31.67, 119.57], 13);
    
    // æ·»åŠ OpenStreetMapå›¾å±‚
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
	  opacity: 0.6
    }).addTo(map);
	
	// å¤©æ°”åœ°å›¾åŠŸèƒ½
	let weatherLayer = null;
	let weatherLegend = null
	
	let selectedRoute = null;
	
	var measureControl = null;
	var measuredDistance = 0;
    
    // å­˜å‚¨ç‚¹åæ ‡å’ŒæŠ˜çº¿
    var route1Points = [];
    var route2Points = [];
	var route3Points = [];
	var route4Points = [];
    var route5Points = [];
	var route6Points = [];
	var route7Points = [];
    var route8Points = [];
	var route9Points = [];
	var route10Points = [];
	var route11Points = [];
	var route12Points = [];
	var route13Points = [];
	var route14Points = [];
	var route15Points = [];
	var route16Points = [];
	
    var route1Polyline = null;
    var route2Polyline = null;
	var route3Polyline = null;
	var route4Polyline = null;
    var route5Polyline = null;
	var route6Polyline = null;
	var route7Polyline = null;
    var route8Polyline = null;
	var route9Polyline = null;
	var route10Polyline = null;
	var route11Polyline = null;
	var route12Polyline = null;
	var route13Polyline = null;
	var route14Polyline = null;
	var route15Polyline = null;
	var route16Polyline = null;
	
    var startMarker1 = null;
    var endMarker1 = null;
    var startMarker2 = null;
    var endMarker2 = null;
	var startMarker3 = null;
    var endMarker3 = null;
	var startMarker4 = null;
    var endMarker4 = null;
    var startMarker5 = null;
    var endMarker5 = null;
	var startMarker6 = null;
    var endMarker6 = null;
	var startMarker7 = null;
    var endMarker7 = null;
    var startMarker8 = null;
    var endMarker8 = null;
	var startMarker9 = null;
    var endMarker9 = null;
	var startMarker10 = null;
    var endMarker10 = null;
	var startMarker11 = null;
    var endMarker11 = null;
	var startMarker12 = null;
    var endMarker12 = null;
	var startMarker13 = null;
    var endMarker13 = null;
	var startMarker14 = null;
    var endMarker14 = null;
	var startMarker15 = null;
    var endMarker15 = null;
	var startMarker16 = null;
    var endMarker16 = null;
	
    // åŠ è½½ç¬¬ä¸€ä¸ªKMLæ–‡ä»¶
    var kmlLayer1 = omnivore.kml('https://raw.githubusercontent.com/qiuqiu-22/KMLRouteMap/refs/heads/main/KMLFile/20240910%E6%88%B7%E5%A4%96%E9%AA%91%E8%A1%8C.kml')
      .on('ready', function() {
        console.log('KML 1 loaded!');
        
        // æ”¶é›†æ‰€æœ‰ç‚¹åæ ‡
        this.eachLayer(function(layer) {
          if (layer instanceof L.Marker) {
            route1Points.push(layer.getLatLng());
          }
        });
        
        // åˆ›å»ºæŠ˜çº¿
        if (route1Points.length > 0) {
          route1Polyline = L.polyline(route1Points, {
            color: '#FFB6C1',
            weight: 5,
            opacity: 0.6,
            smoothFactor: 1
          }).addTo(map)
			.on('click', function(e) {
		      selectRoute('1');
			});
          
          // æ·»åŠ èµ·ç‚¹å’Œç»ˆç‚¹æ ‡è®°
          if (route1Points.length > 1) {
            startMarker1 = L.marker(route1Points[0], {
              title: 'è·¯çº¿1èµ·ç‚¹',
              opacity: 0
            }).bindPopup('2024å¹´09æœˆ10æ—¥éª‘è¡Œèµ·ç‚¹').addTo(map);
            
            endMarker1 = L.marker(route1Points[route1Points.length-1], {
              title: 'è·¯çº¿1ç»ˆç‚¹',
              opacity: 0
            }).bindPopup('2024å¹´09æœˆ10æ—¥éª‘è¡Œç»ˆç‚¹').addTo(map);
          }
        }
      })
      .on('error', function(e) {
        console.error('KML 1 error:', e);
      });
    
    // åŠ è½½ç¬¬äºŒä¸ªKMLæ–‡ä»¶
    var kmlLayer2 = omnivore.kml('https://raw.githubusercontent.com/qiuqiu-22/KMLRouteMap/refs/heads/main/KMLFile/20240921%E6%88%B7%E5%A4%96%E9%AA%91%E8%A1%8C.kml')
      .on('ready', function() {
        console.log('KML 2 loaded!');
        
        // æ”¶é›†æ‰€æœ‰ç‚¹åæ ‡
        this.eachLayer(function(layer) {
          if (layer instanceof L.Marker) {
            route2Points.push(layer.getLatLng());
          }
        });
        
        // åˆ›å»ºæŠ˜çº¿
        if (route2Points.length > 0) {
          route2Polyline = L.polyline(route2Points, {
            color: '#8B008B',
            weight: 5,
            opacity: 0.6,
            smoothFactor: 1
          }).addTo(map)
			.on('click', function(e) {
		      selectRoute('2');
			});
			
		  // æ·»åŠ èµ·ç‚¹å’Œç»ˆç‚¹æ ‡è®°
          if (route2Points.length > 1) {
            startMarker2 = L.marker(route2Points[0], {
              title: 'è·¯çº¿1èµ·ç‚¹',
              opacity: 0
            }).bindPopup('2024å¹´09æœˆ21æ—¥éª‘è¡Œèµ·ç‚¹').addTo(map);
            
            endMarker2 = L.marker(route2Points[route2Points.length-1], {
              title: 'è·¯çº¿1ç»ˆç‚¹',
              opacity: 0
            }).bindPopup('2024å¹´09æœˆ21æ—¥éª‘è¡Œç»ˆç‚¹').addTo(map);
          }
        }
      })
      .on('error', function(e) {
        console.error('KML 2 error:', e);
      });
	  
	// åŠ è½½ç¬¬ä¸‰ä¸ªKMLæ–‡ä»¶
    var kmlLayer3 = omnivore.kml('https://raw.githubusercontent.com/qiuqiu-22/KMLRouteMap/refs/heads/main/KMLFile/20241020%E6%88%B7%E5%A4%96%E9%AA%91%E8%A1%8C.kml')
      .on('ready', function() {
        console.log('KML 3 loaded!');
        
        // æ”¶é›†æ‰€æœ‰ç‚¹åæ ‡
        this.eachLayer(function(layer) {
          if (layer instanceof L.Marker) {
            route3Points.push(layer.getLatLng());
          }
        });
        
        // åˆ›å»ºæŠ˜çº¿
        if (route3Points.length > 0) {
          route3Polyline = L.polyline(route3Points, {
            color: '#483D8B',
            weight: 5,
            opacity: 0.6,
            smoothFactor: 1
          }).addTo(map)
			.on('click', function(e) {
		      selectRoute('3');
			});
			
		  // æ·»åŠ èµ·ç‚¹å’Œç»ˆç‚¹æ ‡è®°
          if (route3Points.length > 1) {
            startMarker3 = L.marker(route3Points[0], {
              title: 'è·¯çº¿3èµ·ç‚¹',
              opacity: 0
            }).bindPopup('2024å¹´10æœˆ20æ—¥éª‘è¡Œèµ·ç‚¹').addTo(map);
            
            endMarker3 = L.marker(route3Points[route3Points.length-1], {
              title: 'è·¯çº¿3ç»ˆç‚¹',
              opacity: 0
            }).bindPopup('2024å¹´10æœˆ20æ—¥éª‘è¡Œç»ˆç‚¹').addTo(map);
          }
        }
      })
      .on('error', function(e) {
        console.error('KML 3 error:', e);
      });
	  
	// åŠ è½½ç¬¬å››ä¸ªKMLæ–‡ä»¶
    var kmlLayer4 = omnivore.kml('https://raw.githubusercontent.com/qiuqiu-22/KMLRouteMap/refs/heads/main/KMLFile/20241027%E6%88%B7%E5%A4%96%E9%AA%91%E8%A1%8C.kml')
      .on('ready', function() {
        console.log('KML 4 loaded!');
        
        // æ”¶é›†æ‰€æœ‰ç‚¹åæ ‡
        this.eachLayer(function(layer) {
          if (layer instanceof L.Marker) {
            route4Points.push(layer.getLatLng());
          }
        });
        
        // åˆ›å»ºæŠ˜çº¿
        if (route4Points.length > 0) {
          route4Polyline = L.polyline(route4Points, {
            color: '#000080',
            weight: 5,
            opacity: 0.6,
            smoothFactor: 1
          }).addTo(map)
			.on('click', function(e) {
		      selectRoute('4');
			});
		  
		  // æ·»åŠ èµ·ç‚¹å’Œç»ˆç‚¹æ ‡è®°
          if (route4Points.length > 1) {
            startMarker4 = L.marker(route4Points[0], {
              title: 'è·¯çº¿4èµ·ç‚¹',
              opacity: 0
            }).bindPopup('2024å¹´10æœˆ27æ—¥éª‘è¡Œèµ·ç‚¹').addTo(map);
            
            endMarker4 = L.marker(route4Points[route4Points.length-1], {
              title: 'è·¯çº¿4ç»ˆç‚¹',
              opacity: 0
            }).bindPopup('2024å¹´10æœˆ27æ—¥éª‘è¡Œç»ˆç‚¹').addTo(map);
          }
        }
      })
      .on('error', function(e) {
        console.error('KML 4 error:', e);
      });
	  
	// åŠ è½½ç¬¬äº”ä¸ªKMLæ–‡ä»¶
    var kmlLayer5 = omnivore.kml('https://raw.githubusercontent.com/qiuqiu-22/KMLRouteMap/refs/heads/main/KMLFile/20241102%E6%88%B7%E5%A4%96%E9%AA%91%E8%A1%8C.kml')
      .on('ready', function() {
        console.log('KML 5 loaded!');
        
        // æ”¶é›†æ‰€æœ‰ç‚¹åæ ‡
        this.eachLayer(function(layer) {
          if (layer instanceof L.Marker) {
            route5Points.push(layer.getLatLng());
          }
        });
        
        // åˆ›å»ºæŠ˜çº¿
        if (route5Points.length > 0) {
          route5Polyline = L.polyline(route5Points, {
            color: '#00FFFF',
            weight: 5,
            opacity: 0.6,
            smoothFactor: 1
          }).addTo(map)
			.on('click', function(e) {
		      selectRoute('5');
			});
			
		  // æ·»åŠ èµ·ç‚¹å’Œç»ˆç‚¹æ ‡è®°
          if (route5Points.length > 1) {
            startMarker5 = L.marker(route5Points[0], {
              title: 'è·¯çº¿5èµ·ç‚¹',
              opacity: 0
            }).bindPopup('2024å¹´11æœˆ02æ—¥éª‘è¡Œèµ·ç‚¹').addTo(map);
            
            endMarker5 = L.marker(route5Points[route5Points.length-1], {
              title: 'è·¯çº¿5ç»ˆç‚¹',
              opacity: 0
            }).bindPopup('2024å¹´11æœˆ02æ—¥éª‘è¡Œç»ˆç‚¹').addTo(map);
          }
        }
      })
      .on('error', function(e) {
        console.error('KML 5 error:', e);
      });
	  
	// åŠ è½½ç¬¬å…­ä¸ªKMLæ–‡ä»¶
    var kmlLayer6 = omnivore.kml('https://raw.githubusercontent.com/qiuqiu-22/KMLRouteMap/refs/heads/main/KMLFile/20250301%E6%88%B7%E5%A4%96%E9%AA%91%E8%A1%8C.kml')
      .on('ready', function() {
        console.log('KML 6 loaded!');
        
        // æ”¶é›†æ‰€æœ‰ç‚¹åæ ‡
        this.eachLayer(function(layer) {
          if (layer instanceof L.Marker) {
            route6Points.push(layer.getLatLng());
          }
        });
        
        // åˆ›å»ºæŠ˜çº¿
        if (route6Points.length > 0) {
          route6Polyline = L.polyline(route6Points, {
            color: '#3CB371',
            weight: 5,
            opacity: 0.6,
            smoothFactor: 1
          }).addTo(map)
			.on('click', function(e) {
		      selectRoute('6');
			});
			
		  // æ·»åŠ èµ·ç‚¹å’Œç»ˆç‚¹æ ‡è®°
          if (route6Points.length > 1) {
            startMarker6 = L.marker(route6Points[0], {
              title: 'è·¯çº¿6èµ·ç‚¹',
              opacity: 0
            }).bindPopup('2025å¹´03æœˆ01æ—¥éª‘è¡Œèµ·ç‚¹').addTo(map);
            
            endMarker6 = L.marker(route6Points[route6Points.length-1], {
              title: 'è·¯çº¿6ç»ˆç‚¹',
              opacity: 0
            }).bindPopup('2025å¹´03æœˆ01æ—¥éª‘è¡Œç»ˆç‚¹').addTo(map);
          }
        }
      })
      .on('error', function(e) {
        console.error('KML 6 error:', e);
      });
	  
	// åŠ è½½ç¬¬ä¸ƒä¸ªKMLæ–‡ä»¶
    var kmlLayer7 = omnivore.kml('https://raw.githubusercontent.com/qiuqiu-22/KMLRouteMap/refs/heads/main/KMLFile/20250322%E6%88%B7%E5%A4%96%E9%AA%91%E8%A1%8C.kml')
      .on('ready', function() {
        console.log('KML 7 loaded!');
        
        // æ”¶é›†æ‰€æœ‰ç‚¹åæ ‡
        this.eachLayer(function(layer) {
          if (layer instanceof L.Marker) {
            route7Points.push(layer.getLatLng());
          }
        });
        
        // åˆ›å»ºæŠ˜çº¿
        if (route7Points.length > 0) {
          route7Polyline = L.polyline(route7Points, {
            color: '#DAA520',
            weight: 5,
            opacity: 0.6,
            smoothFactor: 1
          }).addTo(map)
			.on('click', function(e) {
		      selectRoute('7');
			});
			
		  // æ·»åŠ èµ·ç‚¹å’Œç»ˆç‚¹æ ‡è®°
          if (route7Points.length > 1) {
            startMarker7 = L.marker(route7Points[0], {
              title: 'è·¯çº¿7èµ·ç‚¹',
              opacity: 0
            }).bindPopup('2025å¹´03æœˆ22æ—¥éª‘è¡Œèµ·ç‚¹').addTo(map);
            
            endMarker7 = L.marker(route7Points[route7Points.length-1], {
              title: 'è·¯çº¿7ç»ˆç‚¹',
              opacity: 0
            }).bindPopup('2025å¹´03æœˆ22æ—¥éª‘è¡Œç»ˆç‚¹').addTo(map);
          }
        }
      })
      .on('error', function(e) {
        console.error('KML 7 error:', e);
      });
	  
	// åŠ è½½ç¬¬å…«ä¸ªKMLæ–‡ä»¶
    var kmlLayer8 = omnivore.kml('https://raw.githubusercontent.com/qiuqiu-22/KMLRouteMap/refs/heads/main/KMLFile/20250325%E6%88%B7%E5%A4%96%E9%AA%91%E8%A1%8C.kml')
      .on('ready', function() {
        console.log('KML 8 loaded!');
        
        // æ”¶é›†æ‰€æœ‰ç‚¹åæ ‡
        this.eachLayer(function(layer) {
          if (layer instanceof L.Marker) {
            route8Points.push(layer.getLatLng());
          }
        });
        
        // åˆ›å»ºæŠ˜çº¿
        if (route8Points.length > 0) {
          route8Polyline = L.polyline(route8Points, {
            color: '#FF4500',
            weight: 5,
            opacity: 0.6,
            smoothFactor: 1
          }).addTo(map)
			.on('click', function(e) {
		      selectRoute('8');
			});
			
		  // æ·»åŠ èµ·ç‚¹å’Œç»ˆç‚¹æ ‡è®°
          if (route8Points.length > 1) {
            startMarker8 = L.marker(route8Points[0], {
              title: 'è·¯çº¿8èµ·ç‚¹',
              opacity: 0
            }).bindPopup('2025å¹´03æœˆ25æ—¥éª‘è¡Œèµ·ç‚¹').addTo(map);
            
            endMarker8 = L.marker(route8Points[route8Points.length-1], {
              title: 'è·¯çº¿8ç»ˆç‚¹',
              opacity: 0
            }).bindPopup('2025å¹´03æœˆ25æ—¥éª‘è¡Œç»ˆç‚¹').addTo(map);
          }
        }
      })
      .on('error', function(e) {
        console.error('KML 8 error:', e);
      });
	  
	// åŠ è½½ç¬¬ä¹ä¸ªKMLæ–‡ä»¶
    var kmlLayer9 = omnivore.kml('https://raw.githubusercontent.com/qiuqiu-22/KMLRouteMap/refs/heads/main/KMLFile/20250603%E6%88%B7%E5%A4%96%E9%AA%91%E8%A1%8C.kml')
      .on('ready', function() {
        console.log('KML 9 loaded!');
        
        // æ”¶é›†æ‰€æœ‰ç‚¹åæ ‡
        this.eachLayer(function(layer) {
          if (layer instanceof L.Marker) {
            route9Points.push(layer.getLatLng());
          }
        });
        
        // åˆ›å»ºæŠ˜çº¿
        if (route9Points.length > 0) {
          route9Polyline = L.polyline(route9Points, {
            color: '#8B0000',
            weight: 5,
            opacity: 0.6,
            smoothFactor: 1
          }).addTo(map)
			.on('click', function(e) {
		      selectRoute('9');
			});
			
		  // æ·»åŠ èµ·ç‚¹å’Œç»ˆç‚¹æ ‡è®°
          if (route9Points.length > 1) {
            startMarker9 = L.marker(route9Points[0], {
              title: 'è·¯çº¿9èµ·ç‚¹',
              opacity: 0
            }).bindPopup('2025å¹´06æœˆ03æ—¥éª‘è¡Œèµ·ç‚¹').addTo(map);
            
            endMarker9 = L.marker(route9Points[route9Points.length-1], {
              title: 'è·¯çº¿9ç»ˆç‚¹',
              opacity: 0
            }).bindPopup('2025å¹´06æœˆ03æ—¥éª‘è¡Œç»ˆç‚¹').addTo(map);
          }
        }
      })
      .on('error', function(e) {
        console.error('KML 9 error:', e);
      });
	  
	// åŠ è½½ç¬¬åä¸ªKMLæ–‡ä»¶
    var kmlLayer10 = omnivore.kml('https://raw.githubusercontent.com/qiuqiu-22/KMLRouteMap/refs/heads/main/KMLFile/20250605%E6%88%B7%E5%A4%96%E9%AA%91%E8%A1%8C.kml')
      .on('ready', function() {
        console.log('KML 10 loaded!');
        
        // æ”¶é›†æ‰€æœ‰ç‚¹åæ ‡
        this.eachLayer(function(layer) {
          if (layer instanceof L.Marker) {
            route10Points.push(layer.getLatLng());
          }
        });
        
        // åˆ›å»ºæŠ˜çº¿
        if (route10Points.length > 0) {
          route10Polyline = L.polyline(route10Points, {
            color: '#8B2070',
            weight: 5,
            opacity: 0.6,
            smoothFactor: 1
          }).addTo(map)
			.on('click', function(e) {
		      selectRoute('10');
			});
			
		  // æ·»åŠ èµ·ç‚¹å’Œç»ˆç‚¹æ ‡è®°
          if (route10Points.length > 1) {
            startMarker10 = L.marker(route10Points[0], {
              title: 'è·¯çº¿10èµ·ç‚¹',
              opacity: 0
            }).bindPopup('2025å¹´06æœˆ05æ—¥éª‘è¡Œèµ·ç‚¹').addTo(map);
            
            endMarker10 = L.marker(route10Points[route10Points.length-1], {
              title: 'è·¯çº¿10ç»ˆç‚¹',
              opacity: 0
            }).bindPopup('2025å¹´06æœˆ05æ—¥éª‘è¡Œç»ˆç‚¹').addTo(map);
          }
        }
      })
      .on('error', function(e) {
        console.error('KML 10 error:', e);
      });
	  
	// åŠ è½½ç¬¬åä¸€ä¸ªKMLæ–‡ä»¶
    var kmlLayer11 = omnivore.kml('https://raw.githubusercontent.com/qiuqiu-22/KMLRouteMap/refs/heads/main/KMLFile/20250617%E6%88%B7%E5%A4%96%E9%AA%91%E8%A1%8C.kml')
      .on('ready', function() {
        console.log('KML 11 loaded!');
        
        // æ”¶é›†æ‰€æœ‰ç‚¹åæ ‡
        this.eachLayer(function(layer) {
          if (layer instanceof L.Marker) {
            route11Points.push(layer.getLatLng());
          }
        });
        
        // åˆ›å»ºæŠ˜çº¿
        if (route11Points.length > 0) {
          route11Polyline = L.polyline(route11Points, {
            color: '#8B2610',
            weight: 5,
            opacity: 0.6,
            smoothFactor: 1
          }).addTo(map)
			.on('click', function(e) {
		      selectRoute('11');
			});
			
		  // æ·»åŠ èµ·ç‚¹å’Œç»ˆç‚¹æ ‡è®°
          if (route11Points.length > 1) {
            startMarker11 = L.marker(route11Points[0], {
              title: 'è·¯çº¿11èµ·ç‚¹',
              opacity: 0
            }).bindPopup('2025å¹´06æœˆ17æ—¥éª‘è¡Œèµ·ç‚¹').addTo(map);
            
            endMarker11 = L.marker(route11Points[route11Points.length-1], {
              title: 'è·¯çº¿11ç»ˆç‚¹',
              opacity: 0
            }).bindPopup('2025å¹´06æœˆ17æ—¥éª‘è¡Œç»ˆç‚¹').addTo(map);
          }
        }
      })
      .on('error', function(e) {
        console.error('KML 11 error:', e);
      });
	  
	// åŠ è½½ç¬¬åäºŒä¸ªKMLæ–‡ä»¶
    var kmlLayer12 = omnivore.kml('https://raw.githubusercontent.com/qiuqiu-22/KMLRouteMap/refs/heads/main/KMLFile/20250623%E6%88%B7%E5%A4%96%E9%AA%91%E8%A1%8C.kml')
      .on('ready', function() {
        console.log('KML 12 loaded!');
        
        // æ”¶é›†æ‰€æœ‰ç‚¹åæ ‡
        this.eachLayer(function(layer) {
          if (layer instanceof L.Marker) {
            route12Points.push(layer.getLatLng());
          }
        });
        
        // åˆ›å»ºæŠ˜çº¿
        if (route12Points.length > 0) {
          route12Polyline = L.polyline(route12Points, {
            color: '#8F211A',
            weight: 5,
            opacity: 0.6,
            smoothFactor: 1
          }).addTo(map)
			.on('click', function(e) {
		      selectRoute('12');
			});
			
		  // æ·»åŠ èµ·ç‚¹å’Œç»ˆç‚¹æ ‡è®°
          if (route12Points.length > 1) {
            startMarker12 = L.marker(route12Points[0], {
              title: 'è·¯çº¿12èµ·ç‚¹',
              opacity: 0
            }).bindPopup('2025å¹´06æœˆ23æ—¥éª‘è¡Œèµ·ç‚¹').addTo(map);
            
            endMarker12 = L.marker(route12Points[route12Points.length-1], {
              title: 'è·¯çº¿12ç»ˆç‚¹',
              opacity: 0
            }).bindPopup('2025å¹´06æœˆ23æ—¥éª‘è¡Œç»ˆç‚¹').addTo(map);
          }
        }
      })
      .on('error', function(e) {
        console.error('KML 12 error:', e);
      });
	
	// åŠ è½½ç¬¬åä¸‰ä¸ªKMLæ–‡ä»¶
    var kmlLayer13 = omnivore.kml('https://raw.githubusercontent.com/qiuqiu-22/KMLRouteMap/refs/heads/main/KMLFile/20250727%E6%88%B7%E5%A4%96%E9%AA%91%E8%A1%8C.kml')
      .on('ready', function() {
        console.log('KML 13 loaded!');
        
        // æ”¶é›†æ‰€æœ‰ç‚¹åæ ‡
        this.eachLayer(function(layer) {
          if (layer instanceof L.Marker) {
            route13Points.push(layer.getLatLng());
          }
        });
        
        // åˆ›å»ºæŠ˜çº¿
        if (route13Points.length > 0) {
          route13Polyline = L.polyline(route13Points, {
            color: '#8A261A',
            weight: 5,
            opacity: 0.6,
            smoothFactor: 1
          }).addTo(map)
			.on('click', function(e) {
		      selectRoute('13');
			});
			
		  // æ·»åŠ èµ·ç‚¹å’Œç»ˆç‚¹æ ‡è®°
          if (route13Points.length > 1) {
            startMarker13 = L.marker(route13Points[0], {
              title: 'è·¯çº¿13èµ·ç‚¹',
              opacity: 0
            }).bindPopup('2025å¹´07æœˆ27æ—¥éª‘è¡Œèµ·ç‚¹').addTo(map);
            
            endMarker13 = L.marker(route13Points[route13Points.length-1], {
              title: 'è·¯çº¿13ç»ˆç‚¹',
              opacity: 0
            }).bindPopup('2025å¹´07æœˆ27æ—¥éª‘è¡Œç»ˆç‚¹').addTo(map);
          }
        }
      })
      .on('error', function(e) {
        console.error('KML 13 error:', e);
      });
	
	// åŠ è½½ç¬¬åå››ä¸ªKMLæ–‡ä»¶
    var kmlLayer14 = omnivore.kml('https://raw.githubusercontent.com/qiuqiu-22/KMLRouteMap/refs/heads/main/KMLFile/20250728%E6%88%B7%E5%A4%96%E9%AA%91%E8%A1%8C.kml')
      .on('ready', function() {
        console.log('KML 14 loaded!');
        
        // æ”¶é›†æ‰€æœ‰ç‚¹åæ ‡
        this.eachLayer(function(layer) {
          if (layer instanceof L.Marker) {
            route14Points.push(layer.getLatLng());
          }
        });
        
        // åˆ›å»ºæŠ˜çº¿
        if (route14Points.length > 0) {
          route14Polyline = L.polyline(route14Points, {
            color: '#8A2771',
            weight: 5,
            opacity: 0.6,
            smoothFactor: 1
          }).addTo(map)
			.on('click', function(e) {
		      selectRoute('14');
			});
			
		  // æ·»åŠ èµ·ç‚¹å’Œç»ˆç‚¹æ ‡è®°
          if (route14Points.length > 1) {
            startMarker14 = L.marker(route14Points[0], {
              title: 'è·¯çº¿14èµ·ç‚¹',
              opacity: 0
            }).bindPopup('2025å¹´07æœˆ28æ—¥éª‘è¡Œèµ·ç‚¹').addTo(map);
            
            endMarker14 = L.marker(route14Points[route14Points.length-1], {
              title: 'è·¯çº¿14ç»ˆç‚¹',
              opacity: 0
            }).bindPopup('2025å¹´07æœˆ28æ—¥éª‘è¡Œç»ˆç‚¹').addTo(map);
          }
        }
      })
      .on('error', function(e) {
        console.error('KML 14 error:', e);
      });
	
	// åŠ è½½ç¬¬åäº”ä¸ªKMLæ–‡ä»¶
    var kmlLayer15 = omnivore.kml('https://raw.githubusercontent.com/qiuqiu-22/KMLRouteMap/refs/heads/main/KMLFile/20250824%E6%88%B7%E5%A4%96%E9%AA%91%E8%A1%8C.kml')
      .on('ready', function() {
        console.log('KML 15 loaded!');
        
        // æ”¶é›†æ‰€æœ‰ç‚¹åæ ‡
        this.eachLayer(function(layer) {
          if (layer instanceof L.Marker) {
            route15Points.push(layer.getLatLng());
          }
        });
        
        // åˆ›å»ºæŠ˜çº¿
        if (route15Points.length > 0) {
          route15Polyline = L.polyline(route15Points, {
            color: '#2F56CA',
            weight: 5,
            opacity: 0.6,
            smoothFactor: 1
          }).addTo(map)
			.on('click', function(e) {
		      selectRoute('15');
			});
          
          // æ·»åŠ èµ·ç‚¹å’Œç»ˆç‚¹æ ‡è®°
          if (route15Points.length > 1) {
            startMarker15 = L.marker(route15Points[0], {
              title: 'è·¯çº¿15èµ·ç‚¹',
              opacity: 0
            }).bindPopup('2025å¹´08æœˆ24æ—¥éª‘è¡Œèµ·ç‚¹').addTo(map);
            
            endMarker15 = L.marker(route15Points[route15Points.length-1], {
              title: 'è·¯çº¿15ç»ˆç‚¹',
              opacity: 0
            }).bindPopup('2025å¹´08æœˆ24æ—¥éª‘è¡Œç»ˆç‚¹').addTo(map);
          }
        }
      })
      .on('error', function(e) {
        console.error('KML 15 error:', e);
      });
	
	// åŠ è½½ç¬¬åå…­ä¸ªKMLæ–‡ä»¶
    var kmlLayer16 = omnivore.kml('https://raw.githubusercontent.com/qiuqiu-22/KMLRouteMap/refs/heads/main/KMLFile/20250826%E6%88%B7%E5%A4%96%E9%AA%91%E8%A1%8C.kml')
      .on('ready', function() {
        console.log('KML 16 loaded!');
        
        // æ”¶é›†æ‰€æœ‰ç‚¹åæ ‡
        this.eachLayer(function(layer) {
          if (layer instanceof L.Marker) {
            route16Points.push(layer.getLatLng());
          }
        });
        
        // åˆ›å»ºæŠ˜çº¿
        if (route16Points.length > 0) {
          route16Polyline = L.polyline(route16Points, {
            color: '#6F16C1',
            weight: 5,
            opacity: 0.6,
            smoothFactor: 1
          }).addTo(map)
			.on('click', function(e) {
		      selectRoute('16');
			});
          
          // æ·»åŠ èµ·ç‚¹å’Œç»ˆç‚¹æ ‡è®°
          if (route16Points.length > 1) {
            startMarker16 = L.marker(route16Points[0], {
              title: 'è·¯çº¿16èµ·ç‚¹',
              opacity: 0
            }).bindPopup('2025å¹´08æœˆ26æ—¥éª‘è¡Œèµ·ç‚¹').addTo(map);
            
            endMarker16 = L.marker(route16Points[route16Points.length-1], {
              title: 'è·¯çº¿16ç»ˆç‚¹',
              opacity: 0
            }).bindPopup('2025å¹´08æœˆ26æ—¥éª‘è¡Œç»ˆç‚¹').addTo(map);
          }
        }
      })
      .on('error', function(e) {
        console.error('KML 16 error:', e);
      });
	
	// é€‰æ‹©æŸä¸€æ¡è·¯çº¿
	function selectRoute(routeId) {
      // é‡ç½®æ‰€æœ‰è·¯çº¿æ ·å¼
      resetAllRoutes();
      // æ›´æ–°é€‰ä¸­è·¯çº¿
      selectedRoute = routeId;
      // é«˜äº®æ˜¾ç¤º
	  highlightRoute(routeId);      
      }
	
	// é‡ç½®æ‰€æœ‰è·¯çº¿åˆ°é»˜è®¤çŠ¶æ€
    function resetAllRoutes() {
      if (route1Polyline) {
		route1Polyline.setStyle({ weight: 5, opacity: 0.6 });
		startMarker1.setOpacity(0);
		endMarker1.setOpacity(0);
	  }
      if (route2Polyline) {
		route2Polyline.setStyle({ weight: 5, opacity: 0.6 });
		startMarker2.setOpacity(0);
		endMarker2.setOpacity(0);
	  }
      if (route3Polyline) {
		route3Polyline.setStyle({ weight: 5, opacity: 0.6 });
		startMarker3.setOpacity(0);
		endMarker3.setOpacity(0);
	  }
      if (route4Polyline) {
		route4Polyline.setStyle({ weight: 5, opacity: 0.6 });
		startMarker4.setOpacity(0);
		endMarker4.setOpacity(0);
	  }
      if (route5Polyline) {
		route5Polyline.setStyle({ weight: 5, opacity: 0.6 });
		startMarker5.setOpacity(0);
		endMarker5.setOpacity(0);
	  }
      if (route6Polyline) {
		route6Polyline.setStyle({ weight: 5, opacity: 0.6 });
		startMarker6.setOpacity(0);
		endMarker6.setOpacity(0);
	  }
      if (route7Polyline) {
		route7Polyline.setStyle({ weight: 5, opacity: 0.6 });
		startMarker7.setOpacity(0);
		endMarker7.setOpacity(0);
	  }
      if (route8Polyline) {
		route8Polyline.setStyle({ weight: 5, opacity: 0.6 });
		startMarker8.setOpacity(0);
		endMarker8.setOpacity(0);
	  }
      if (route9Polyline) {
		route9Polyline.setStyle({ weight: 5, opacity: 0.6 });
		startMarker9.setOpacity(0);
		endMarker9.setOpacity(0);
	  }
	  if (route10Polyline) {
		route10Polyline.setStyle({ weight: 5, opacity: 0.6 });
		startMarker10.setOpacity(0);
		endMarker10.setOpacity(0);
	  }
	  if (route11Polyline) {
		route11Polyline.setStyle({ weight: 5, opacity: 0.6 });
		startMarker11.setOpacity(0);
		endMarker11.setOpacity(0);
	  }
	  if (route12Polyline) {
		route12Polyline.setStyle({ weight: 5, opacity: 0.6 });
		startMarker12.setOpacity(0);
		endMarker12.setOpacity(0);
	  }
	  if (route13Polyline) {
		route13Polyline.setStyle({ weight: 5, opacity: 0.6 });
		startMarker13.setOpacity(0);
		endMarker13.setOpacity(0);
	  }
	  if (route14Polyline) {
		route14Polyline.setStyle({ weight: 5, opacity: 0.6 });
		startMarker14.setOpacity(0);
		endMarker14.setOpacity(0);
	  }
	  if (route15Polyline) {
		route15Polyline.setStyle({ weight: 5, opacity: 0.6 });
		startMarker15.setOpacity(0);
		endMarker15.setOpacity(0);
	  }
	  if (route16Polyline) {
		route16Polyline.setStyle({ weight: 5, opacity: 0.6 });
		startMarker16.setOpacity(0);
		endMarker16.setOpacity(0);
	  }
    }
    
    // åŠ ç²—æ˜¾ç¤ºé€‰ä¸­çš„è·¯çº¿
    function highlightRoute(routeId) {
	  
      selectedRoute = routeId;
      
      switch(routeId) {
        case '1':
          if (route1Polyline) {
			route1Polyline.setStyle({ weight: 8, opacity: 1 });
			startMarker1.setOpacity(1);
			endMarker1.setOpacity(1);
		  }
          break;
        case '2':
          if (route2Polyline) {
			route2Polyline.setStyle({ weight: 8, opacity: 1 });
			startMarker2.setOpacity(1);
			endMarker2.setOpacity(1);
		  }
          break;
        case '3':
          if (route3Polyline) {
			route3Polyline.setStyle({ weight: 8, opacity: 1 });
			startMarker3.setOpacity(1);
			endMarker3.setOpacity(1);
		  }
          break;
        case '4':
          if (route4Polyline) {
			route4Polyline.setStyle({ weight: 8, opacity: 1 });
			startMarker4.setOpacity(1);
			endMarker4.setOpacity(1);
		  }
          break;
        case '5':
          if (route5Polyline) {
			route5Polyline.setStyle({ weight: 8, opacity: 1 });
			startMarker5.setOpacity(1);
			endMarker5.setOpacity(1);
		  }
          break;
        case '6':
          if (route6Polyline) {
			route6Polyline.setStyle({ weight: 8, opacity: 1 });
			startMarker6.setOpacity(1);
			endMarker6.setOpacity(1);
		  }
          break;
        case '7':
          if (route7Polyline) {
			route7Polyline.setStyle({ weight: 8, opacity: 1 });
			startMarker7.setOpacity(1);
			endMarker7.setOpacity(1);
		  }
          break;
        case '8':
          if (route8Polyline) {
			route8Polyline.setStyle({ weight: 8, opacity: 1 });
			startMarker8.setOpacity(1);
			endMarker8.setOpacity(1);
		  }
          break;
        case '9':
          if (route9Polyline) {
			route9Polyline.setStyle({ weight: 8, opacity: 1 });
			startMarker9.setOpacity(1);
			endMarker9.setOpacity(1);
		  }
          break;
		case '10':
          if (route10Polyline) {
			route10Polyline.setStyle({ weight: 8, opacity: 1 });
			startMarker10.setOpacity(1);
			endMarker10.setOpacity(1);
		  }
          break;
		case '11':
          if (route11Polyline) {
			route11Polyline.setStyle({ weight: 8, opacity: 1 });
			startMarker11.setOpacity(1);
			endMarker11.setOpacity(1);
		  }
          break;
		case '12':
          if (route12Polyline) {
			route12Polyline.setStyle({ weight: 8, opacity: 1 });
			startMarker12.setOpacity(1);
			endMarker12.setOpacity(1);
		  }
          break;
		case '13':
          if (route13Polyline) {
			route13Polyline.setStyle({ weight: 8, opacity: 1 });
			startMarker13.setOpacity(1);
			endMarker13.setOpacity(1);
		  }
          break;
		case '14':
          if (route14Polyline) {
			route14Polyline.setStyle({ weight: 8, opacity: 1 });
			startMarker14.setOpacity(1);
			endMarker14.setOpacity(1);
		  }
          break;
		case '15':
          if (route15Polyline) {
			route15Polyline.setStyle({ weight: 8, opacity: 1 });
			startMarker15.setOpacity(1);
			endMarker15.setOpacity(1);
		  }
          break;
		case '16':
          if (route16Polyline) {
			route16Polyline.setStyle({ weight: 8, opacity: 1 });
			startMarker16.setOpacity(1);
			endMarker16.setOpacity(1);
		  }
          break;
      }
    }
		
	// ä¾§è¾¹æ æ§åˆ¶å‡½æ•°
	function toggleSidebar() {
	  const sidebar = document.getElementById('sidebar');	  
	  sidebar.classList.toggle('open');
	}
	
	// æ”¹å˜åœ°å›¾ä¸­å¿ƒå‡½æ•°
	function changeMapCenter() {
	  const select = document.getElementById('center-select');
	  const value = select.value;
	  const [lat, lng, zoom] = value.split(',').map(Number);
	  map.setView([lat, lng], zoom);
	}
	
	// ç‚¹å‡»åœ°å›¾å…¶ä»–åœ°æ–¹å…³é—­ä¾§è¾¹æ 
	map.on('click', function() {
      const sidebar = document.getElementById('sidebar');
      if (sidebar.classList.contains('open')) {
        sidebar.classList.remove('open');
      }
    });
	
	// é˜²æ­¢ä¾§è¾¹æ ç‚¹å‡»äº‹ä»¶å†’æ³¡åˆ°åœ°å›¾
    document.getElementById('sidebar').addEventListener('click', function(e) {
      e.stopPropagation();
    });
	
	// å¤©æ°”åŠŸèƒ½
	async function showWeather() {
	  const weatherPanel = document.getElementById('weather-panel');
	  const weatherDetails = document.getElementById('weather-details');
	  
	  // æ˜¾ç¤ºå¤©æ°”é¢æ¿
	  weatherPanel.style.display = 'block';
	  weatherDetails.innerHTML = 'æ­£åœ¨è·å–å¤©æ°”æ•°æ®...';
	  
	  try {
        // è·å–å½“å‰åœ°å›¾ä¸­å¿ƒç‚¹
        const center = map.getCenter();
        const lat = center.lat;
        const lng = center.lng;
		
		// è°ƒç”¨Open-Meteo API
        const response = await fetch(
          `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lng}&current_weather=true`
        );
		const data = await response.json();
		
		// å¤„ç†å¤©æ°”æ•°æ®
        const weather = data.current_weather;
        const weatherDescription = getWeatherDescription(weather.weathercode);
		
		// æ˜¾ç¤ºå¤©æ°”ä¿¡æ¯
		weatherDetails.innerHTML = 
		  '<p><strong>å½“å‰ä½ç½®ï¼š</strong> çº¬åº¦ ' + lat.toFixed(4) + '</p>' +
		  '<p>ç»åº¦ ' + lng.toFixed(4) + '</p>' +
		  '<p><strong>æ¸©åº¦:</strong> ' + weather.temperature + 'Â°C</p>' +
		  '<p><strong>é£é€Ÿ:</strong> ' + weather.windspeed + ' km/h</p>' +
		  '<p><strong>å¤©æ°”:</strong> ' + weatherDescription + '</p>' +
		  '<p><strong>æ›´æ–°æ—¶é—´:</strong> ' + new Date(weather.time).toLocaleString() + '</p>';
	  } catch (error) {
        console.error('è·å–å¤©æ°”æ•°æ®å¤±è´¥:', error);
        weatherDetails.innerHTML = 'è·å–å¤©æ°”æ•°æ®å¤±è´¥ï¼Œè¯·é‡è¯•';
      }
	}
	
	// å¤©æ°”ä»£ç è½¬æ–‡å­—æè¿°
    function getWeatherDescription(code) {
      const weatherMap = {
        0: "æ™´å¤© â˜€ï¸",
        1: "å¤§éƒ¨åˆ†æ™´å¤© ğŸŒ¤",
        2: "éƒ¨åˆ†å¤šäº‘ â›…",
        3: "é˜´å¤© â˜ï¸",
        45: "é›¾ ğŸŒ«",
        48: "å†»é›¾ â„ï¸",
        51: "å°é›¨ ğŸŒ§",
        53: "ä¸­é›¨ ğŸŒ§",
        55: "å¤§é›¨ ğŸŒ§",
        56: "å†»é›¨ â„ï¸",
        57: "å¼ºå†»é›¨ â„ï¸",
        61: "å°é›¨ ğŸŒ§",
        63: "ä¸­é›¨ ğŸŒ§",
        65: "å¤§é›¨ ğŸŒ§",
        66: "å†»é›¨ â„ï¸",
        67: "å¼ºå†»é›¨ â„ï¸",
        71: "å°é›ª â„ï¸",
        73: "ä¸­é›ª â„ï¸",
        75: "å¤§é›ª â„ï¸",
        77: "å†°é›¹ ğŸŒ¨",
        80: "å°é˜µé›¨ ğŸŒ¦",
        81: "ä¸­é˜µé›¨ ğŸŒ¦",
        82: "å¼ºé˜µé›¨ ğŸŒ§",
        85: "å°é˜µé›ª â„ï¸",
        86: "å¤§é˜µé›ª â„ï¸",
        95: "é›·æš´ âš¡",
        96: "é›·æš´ä¼´å°å†°é›¹ âš¡ğŸŒ¨",
        99: "é›·æš´ä¼´å¤§å†°é›¹ âš¡ğŸŒ¨"
      };
      return weatherMap[code] || `æœªçŸ¥å¤©æ°” (ä»£ç : ${code})`;
    }
	
	// åˆå§‹åŒ–å¤©æ°”åœ°å›¾åŠŸèƒ½
	function initWeatherMap() {
	  // æ·»åŠ å¤©æ°”åœ°å›¾æŒ‰é’®äº‹ä»¶ç›‘å¬
	  document.getElementById('show-weather-map').addEventListener('click', showWeatherMap);
	  document.getElementById('hide-weather-map').addEventListener('click', hideWeatherMap);
	  
	  // æ·»åŠ é€æ˜åº¦æ»‘å—äº‹ä»¶ç›‘å¬
	  const opacitySlider = document.getElementById('opacity-slider');
	  const opacityValue = document.getElementById('opacity-value');
	  
	  opacitySlider.addEventListener('input', function() {
		const value = this.value;
		opacityValue.textContent = value + '%';
		currentOpacity = value / 100;
		
		// å¦‚æœå¤©æ°”å›¾å±‚å·²æ˜¾ç¤ºï¼Œå®æ—¶æ›´æ–°é€æ˜åº¦
		if (weatherLayer && map.hasLayer(weatherLayer)) {
		  weatherLayer.setOpacity(currentOpacity);
		}
	  });
	  
	  // è·å–æ‰€æœ‰å¤©æ°”é€‰é¡¹æ ‡ç­¾
	  const weatherOptionLabels = document.querySelectorAll('.weather-option');
	  
	  // åˆå§‹é€‰ä¸­ç¬¬ä¸€ä¸ªé€‰é¡¹
	  weatherOptionLabels[0].classList.add('selected');
	  
	  const weatherTypeRadios = document.querySelectorAll('input[name="weather-type"]');
	  weatherTypeRadios.forEach((radio, index) => {
		radio.addEventListener('change', function() {
		  // ç§»é™¤æ‰€æœ‰é€‰ä¸­æ ·å¼
		  weatherOptionLabels.forEach(label => label.classList.remove('selected'));
		  // æ·»åŠ å½“å‰é€‰ä¸­æ ·å¼
		  weatherOptionLabels[index].classList.add('selected');
		  
		  // åªæœ‰å½“å¤©æ°”åœ°å›¾å·²æ˜¾ç¤ºæ—¶æ‰æ›´æ–°
		  if (weatherLayer && map.hasLayer(weatherLayer)) {
			showWeatherMap();
		  }
		});
	  });
	  
	  // åˆ›å»ºå¤©æ°”å›¾ä¾‹å®¹å™¨
	  weatherLegend = L.control({position: 'bottomright'});
	  weatherLegend.onAdd = function(map) {
		const div = L.DomUtil.create('div', 'weather-legend');
		div.innerHTML = 
		  '<h4>ğŸŒ¡ï¸ æ¸©åº¦å›¾ä¾‹</h4>' +
		  '<div class="legend-gradient temp-gradient"></div>' +
		  '<div class="legend-labels">' +
			'<span>-20Â°C</span>' +
			'<span>0Â°C</span>' +
			'<span>20Â°C</span>' +
			'<span>40Â°C</span>' +
		  '</div>' +
		  '<div class="legend-scale">' +
			'<span>ä½æ¸©</span>' +
			'<span>é«˜æ¸©</span>' +
		  '</div>';
		return div;
	  };
	}

	// æ˜¾ç¤ºå¤©æ°”åœ°å›¾
	async function showWeatherMap() {
	  try {
		// è·å–é€‰ä¸­çš„å¤©æ°”ç±»å‹
		const selectedWeatherType = document.querySelector('input[name="weather-type"]:checked');
		if (!selectedWeatherType) {
		  throw new Error('æœªæ‰¾åˆ°é€‰ä¸­çš„å¤©æ°”ç±»å‹');
		}
		const weatherType = selectedWeatherType.value;
		
		// æ˜¾ç¤ºåŠ è½½çŠ¶æ€
		const showBtn = document.getElementById('show-weather-map');
		const hideBtn = document.getElementById('hide-weather-map');
		showBtn.style.display = 'none';
		hideBtn.style.display = 'block';
		hideBtn.textContent = 'åŠ è½½ä¸­...';
		hideBtn.disabled = true;
		
		// ç§»é™¤ç°æœ‰çš„å¤©æ°”å›¾å±‚
		if (weatherLayer) {
		  map.removeLayer(weatherLayer);
		}
		
		let tileUrl;
		let legendHtml;
		let attribution;
		
		switch(weatherType) {
		  case 'temperature':
			tileUrl = 'https://tile.openweathermap.org/map/temp_new/{z}/{x}/{y}.png?appid=c9e9009c27e558e0f8be0497d8e2d387';
			legendHtml =
			  '<h4>æ¸©åº¦å›¾ä¾‹ (Â°C)</h4>' +
			  '<div class="legend-gradient temp-gradient"></div>' +
			  '<div class="legend-labels">' +
				'<span>20Â°C</span>' +
				'<span>40Â°C</span>' +
			  '</div>';
			attribution = 'Weather data Â© OpenWeatherMap';
			break;
			
		  case 'precipitation':
			tileUrl = 'https://tile.openweathermap.org/map/precipitation_new/{z}/{x}/{y}.png?appid=c9e9009c27e558e0f8be0497d8e2d387';
			legendHtml =
			  '<h4>é™æ°´å›¾ä¾‹ (mm)</h4>' +
			  '<div class="legend-gradient precip-gradient"></div>' +
			  '<div class="legend-labels">' +
				'<span>0</span>' +
				'<span>50</span>' +
			  '</div>';
			attribution = 'Weather data Â© OpenWeatherMap';
			break;
			
		  case 'wind':
			tileUrl = 'https://tile.openweathermap.org/map/wind_new/{z}/{x}/{y}.png?appid=c9e9009c27e558e0f8be0497d8e2d387';
			legendHtml =
			  '<h4>é£é€Ÿå›¾ä¾‹ (m/s)</h4>' +
			  '<div class="legend-gradient wind-gradient"></div>' +
			  '<div class="legend-labels">' +
				'<span>0</span>' +
				'<span>25</span>' +
			  '</div>';
			attribution = 'Weather data Â© OpenWeatherMap';
			break;
		}
		
		// æ·»åŠ æ–°çš„å¤©æ°”å›¾å±‚
		weatherLayer = L.tileLayer(tileUrl, {
		  attribution: attribution,
		  opacity: 0.7,
		  maxZoom: 19
		}).addTo(map);
		
		// æ›´æ–°å›¾ä¾‹
		updateWeatherLegend(legendHtml);
		
		// æ¢å¤æŒ‰é’®çŠ¶æ€
		hideBtn.textContent = 'éšè—å¤©æ°”åœ°å›¾';
		hideBtn.disabled = false;
		
	  } catch (error) {
		console.error('åŠ è½½å¤©æ°”åœ°å›¾å¤±è´¥:', error);
		alert('åŠ è½½å¤©æ°”åœ°å›¾å¤±è´¥ï¼Œè¯·é‡è¯•');
		hideWeatherMap();
	  }
	}

	// éšè—å¤©æ°”åœ°å›¾
	function hideWeatherMap() {
	  if (weatherLayer) {
		map.removeLayer(weatherLayer);
		weatherLayer = null;
	  }
	  
	  // ç§»é™¤å›¾ä¾‹
	  if (weatherLegend) {
		map.removeControl(weatherLegend);
	  }
	  
	  // åˆ‡æ¢æŒ‰é’®çŠ¶æ€
	  document.getElementById('show-weather-map').style.display = 'block';
	  document.getElementById('hide-weather-map').style.display = 'none';
	}

	// æ›´æ–°å¤©æ°”å›¾ä¾‹
	function updateWeatherLegend(html) {
	  // æ ¹æ®ä¸åŒå¤©æ°”ç±»å‹è®¾ç½®ä¸åŒçš„å›¾ä¾‹
	  const selectedWeatherType = document.querySelector('input[name="weather-type"]:checked').value;
	  let legendHtml;
	  
	  switch(selectedWeatherType) {
		case 'temperature':
		  legendHtml =
			'<h4>ğŸŒ¡ï¸ æ¸©åº¦å›¾ä¾‹ (Â°C)</h4>' +
			'<div class="legend-gradient temp-gradient"></div>' +
			'<div class="legend-labels">' +
			  '<span>-20Â°C</span>' +
			  '<span>0Â°C</span>' +
			  '<span>20Â°C</span>' +
			  '<span>40Â°C</span>' +
			'</div>' +
			'<div class="legend-scale">' +
			  '<span>ä½æ¸©</span>' +
			  '<span>é«˜æ¸©</span>' +
			'</div>';
		  break;
		  
		case 'precipitation':
		  legendHtml =
			'<h4>ğŸ’§ é™æ°´å›¾ä¾‹ (mm/h)</h4>' +
			'<div class="legend-gradient precip-gradient"></div>' +
			'<div class="legend-labels">' +
			  '<span>0</span>' +
			  '<span>2.5</span>' +
			  '<span>5</span>' +
			  '<span>10+</span>' +
			'</div>' +
			'<div class="legend-scale">' +
			  '<span>å°é›¨</span>' +
			  '<span>å¤§é›¨</span>' +
			'</div>';
		  break;
		  
		case 'wind':
		  legendHtml =
			'<h4>ğŸ’¨ é£é€Ÿå›¾ä¾‹ (m/s)</h4>' +
			'<div class="legend-gradient wind-gradient"></div>' +
			'<div class="legend-labels">' +
			  '<span>0</span>' +
			  '<span>5</span>' +
			  '<span>10</span>' +
			  '<span>20+</span>' +
			'</div>' +
			'<div class="legend-scale">' +
			  '<span>è½»é£</span>' +
			  '<span>å¼ºé£</span>' +
			'</div>';
		  break;
	  }
	  
	  if (weatherLegend) {
		map.removeControl(weatherLegend);
	  }
	  
	  weatherLegend = L.control({position: 'bottomright'});
	  weatherLegend.onAdd = function(map) {
		const div = L.DomUtil.create('div', 'weather-legend');
		div.innerHTML = legendHtml;
		return div;
	  };
	  
	  weatherLegend.addTo(map);
	}

	// ä¿®æ”¹æŒ‰é’®æ–‡æœ¬ï¼Œæ·»åŠ å›¾æ ‡
	document.getElementById('show-weather-map').textContent = 'ğŸ—ºï¸ æ˜¾ç¤ºå¤©æ°”åœ°å›¾';
	document.getElementById('hide-weather-map').textContent = 'ğŸ‘ï¸ éšè—å¤©æ°”åœ°å›¾';

	// åœ¨é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–å¤©æ°”åœ°å›¾åŠŸèƒ½
	document.addEventListener('DOMContentLoaded', function() {
	  // ç­‰å¾…åœ°å›¾åˆå§‹åŒ–å®Œæˆ
	  setTimeout(initWeatherMap, 1000);
	});
	
	// åˆå§‹åŒ–æµ‹é‡è·ç¦»
	function initDistanceMeasurement() {
	  // æ·»åŠ æµ‹è·æŒ‰é’®äº‹ä»¶ç›‘å¬
	  document.getElementById('start-measuring').addEventListener('click', startMeasuring);
	  document.getElementById('stop-measuring').addEventListener('click', stopMeasuring);
	  
	  // åˆå§‹åŒ–æµ‹è·æ§åˆ¶
	  measureControl = new L.Control.Draw({
		draw: {
		  polygon: false,
		  rectangle: false,
		  circle: false,
		  circlemarker: false,
		  marker: false,
		  polyline: {
			metric: true,
			showLength: true,
			feet: false,
			nautic: false
		  }
		},
		edit: {
		  featureGroup: new L.FeatureGroup()
		}
	  });
	}

	// å¼€å§‹æµ‹è·
	function startMeasuring() {
	  // åˆ‡æ¢æŒ‰é’®çŠ¶æ€
	  document.getElementById('start-measuring').style.display = 'none';
	  document.getElementById('stop-measuring').style.display = 'block';
	  document.getElementById('distance-result').style.display = 'block';
	  
	  // æ·»åŠ æµ‹è·æ§åˆ¶åˆ°åœ°å›¾
	  map.addControl(measureControl);
	  
	  // ç›‘å¬ç»˜åˆ¶äº‹ä»¶
	  map.on(L.Draw.Event.CREATED, function (e) {
		var type = e.layerType,
			layer = e.layer;

		if (type === 'polyline') {
		  // è®¡ç®—è·ç¦»
		  var distance = calculateDistance(layer);
		  measuredDistance = distance;
		  document.getElementById('measured-distance').textContent = distance.toFixed(2);
		  
		  // å°†çº¿æ·»åŠ åˆ°åœ°å›¾
		  var distanceLayer = L.featureGroup().addLayer(layer);
		  map.addLayer(distanceLayer);
		}
	  });
	}

	// åœæ­¢æµ‹è·
	function stopMeasuring() {
	  // åˆ‡æ¢æŒ‰é’®çŠ¶æ€
	  document.getElementById('start-measuring').style.display = 'block';
	  document.getElementById('stop-measuring').style.display = 'none';
	  
	  // ç§»é™¤æµ‹è·æ§åˆ¶
	  map.removeControl(measureControl);
	  
	  // ç§»é™¤ç»˜åˆ¶äº‹ä»¶ç›‘å¬
	  map.off(L.Draw.Event.CREATED);
	}

	// è®¡ç®—è·ç¦»ï¼ˆå…¬é‡Œï¼‰
	function calculateDistance(layer) {
	  var latlngs = layer.getLatLngs();
	  var distance = 0;
	  
	  for (var i = 0; i < latlngs.length - 1; i++) {
		distance += latlngs[i].distanceTo(latlngs[i + 1]);
	  }
	  
	  return distance / 1000; // è½¬æ¢ä¸ºå…¬é‡Œ
	}

	// åœ¨DOMContentLoadedäº‹ä»¶ä¸­æ·»åŠ æµ‹è·åŠŸèƒ½åˆå§‹åŒ–
	document.addEventListener('DOMContentLoaded', function() {
	  // ç­‰å¾…åœ°å›¾åˆå§‹åŒ–å®Œæˆ
	  setTimeout(function() {
		initWeatherMap();
		initDistanceMeasurement(); // åˆå§‹åŒ–æµ‹è·åŠŸèƒ½
	  }, 1000);
	});
  </script>
</body>
</html>


<!DOCTYPE html>
<html lang="zh-CN">
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KMLRouteMap</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-omnivore@0.3.4/leaflet-omnivore.min.js"></script>
  <style>
    #map {
      width: 100%;
      height: 1220px;
    }
	footer {
      text-align: center;
      padding: 4px;
      color: #7f8c8d;
      font-size: 1rem;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <footer>
      <p>使用Leaflet和Leaflet Omnivore实现 | 展示KML骑行路线数据 | made by qiuqiu</p>
	  <a href="https://github.com/qiuqiu-22/KMLRouteMap" style="color: #7f8c8d;">https://github.com/qiuqiu-22/KMLRouteMap</a>
  </footer>
  <script>
    // 2nd Version: V0.1.1 - 2nd submission
  
    // 初始化地图
    var map = L.map('map').setView([31.6, 119.5], 11);
    
    // 添加OpenStreetMap图层
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
	  opacity: 0.6
    }).addTo(map);
	
	let selectedRoute = null;
    
    // 存储点坐标和折线
    var route1Points = [];
    var route2Points = [];
	var route3Points = [];
	var route4Points = [];
    var route5Points = [];
	var route6Points = [];
	var route7Points = [];
    var route8Points = [];
	var route9Points = [];
	var route10Points = [];
    var route1Polyline = null;
    var route2Polyline = null;
	var route3Polyline = null;
	var route4Polyline = null;
    var route5Polyline = null;
	var route6Polyline = null;
	var route7Polyline = null;
    var route8Polyline = null;
	var route9Polyline = null;
	var route10Polyline = null;
    var startMarker1 = null;
    var endMarker1 = null;
    var startMarker2 = null;
    var endMarker2 = null;
	var startMarker3 = null;
    var endMarker3 = null;
	var startMarker4 = null;
    var endMarker4 = null;
    var startMarker5 = null;
    var endMarker5 = null;
	var startMarker6 = null;
    var endMarker6 = null;
	var startMarker7 = null;
    var endMarker7 = null;
    var startMarker8 = null;
    var endMarker8 = null;
	var startMarker9 = null;
    var endMarker9 = null;
	var startMarker10 = null;
    var endMarker10 = null;
    
    // 加载第一个KML文件
    var kmlLayer1 = omnivore.kml('https://raw.githubusercontent.com/qiuqiu-22/KMLRouteMap/refs/heads/main/KMLFile/20240910%E6%88%B7%E5%A4%96%E9%AA%91%E8%A1%8C.kml')
      .on('ready', function() {
        console.log('KML 1 loaded!');
        
        // 收集所有点坐标
        this.eachLayer(function(layer) {
          if (layer instanceof L.Marker) {
            route1Points.push(layer.getLatLng());
          }
        });
        
        // 创建折线
        if (route1Points.length > 0) {
          route1Polyline = L.polyline(route1Points, {
            color: '#FFB6C1',
            weight: 5,
            opacity: 0.6,
            smoothFactor: 1
          }).addTo(map)
			.on('click', function(e) {
		      selectRoute('1');
			});
          
          // 添加起点和终点标记
          if (route1Points.length > 1) {
            startMarker1 = L.marker(route1Points[0], {
              title: '路线1起点',
              opacity: 0
            }).bindPopup('2024年09月10日骑行起点').addTo(map);
            
            endMarker1 = L.marker(route1Points[route1Points.length-1], {
              title: '路线1终点',
              opacity: 0
            }).bindPopup('2024年09月10日骑行终点').addTo(map);
          }
        }
      })
      .on('error', function(e) {
        console.error('KML 1 error:', e);
      });
    
    // 加载第二个KML文件
    var kmlLayer2 = omnivore.kml('https://raw.githubusercontent.com/qiuqiu-22/KMLRouteMap/refs/heads/main/KMLFile/20240921%E6%88%B7%E5%A4%96%E9%AA%91%E8%A1%8C.kml')
      .on('ready', function() {
        console.log('KML 2 loaded!');
        
        // 收集所有点坐标
        this.eachLayer(function(layer) {
          if (layer instanceof L.Marker) {
            route2Points.push(layer.getLatLng());
          }
        });
        
        // 创建折线
        if (route2Points.length > 0) {
          route2Polyline = L.polyline(route2Points, {
            color: '#8B008B',
            weight: 5,
            opacity: 0.6,
            smoothFactor: 1
          }).addTo(map)
			.on('click', function(e) {
		      selectRoute('2');
			});
			
		  // 添加起点和终点标记
          if (route2Points.length > 1) {
            startMarker2 = L.marker(route2Points[0], {
              title: '路线1起点',
              opacity: 0
            }).bindPopup('2024年09月21日骑行起点').addTo(map);
            
            endMarker2 = L.marker(route2Points[route2Points.length-1], {
              title: '路线1终点',
              opacity: 0
            }).bindPopup('2024年09月21日骑行终点').addTo(map);
          }
        }
      })
      .on('error', function(e) {
        console.error('KML 2 error:', e);
      });
	  
	// 加载第三个KML文件
    var kmlLayer3 = omnivore.kml('https://raw.githubusercontent.com/qiuqiu-22/KMLRouteMap/refs/heads/main/KMLFile/20241020%E6%88%B7%E5%A4%96%E9%AA%91%E8%A1%8C.kml')
      .on('ready', function() {
        console.log('KML 3 loaded!');
        
        // 收集所有点坐标
        this.eachLayer(function(layer) {
          if (layer instanceof L.Marker) {
            route3Points.push(layer.getLatLng());
          }
        });
        
        // 创建折线
        if (route3Points.length > 0) {
          route3Polyline = L.polyline(route3Points, {
            color: '#483D8B',
            weight: 5,
            opacity: 0.6,
            smoothFactor: 1
          }).addTo(map)
			.on('click', function(e) {
		      selectRoute('3');
			});
			
		  // 添加起点和终点标记
          if (route3Points.length > 1) {
            startMarker3 = L.marker(route3Points[0], {
              title: '路线3起点',
              opacity: 0
            }).bindPopup('2024年10月20日骑行起点').addTo(map);
            
            endMarker3 = L.marker(route3Points[route3Points.length-1], {
              title: '路线3终点',
              opacity: 0
            }).bindPopup('2024年10月20日骑行终点').addTo(map);
          }
        }
      })
      .on('error', function(e) {
        console.error('KML 3 error:', e);
      });
	  
	// 加载第四个KML文件
    var kmlLayer4 = omnivore.kml('https://raw.githubusercontent.com/qiuqiu-22/KMLRouteMap/refs/heads/main/KMLFile/20241027%E6%88%B7%E5%A4%96%E9%AA%91%E8%A1%8C.kml')
      .on('ready', function() {
        console.log('KML 4 loaded!');
        
        // 收集所有点坐标
        this.eachLayer(function(layer) {
          if (layer instanceof L.Marker) {
            route4Points.push(layer.getLatLng());
          }
        });
        
        // 创建折线
        if (route4Points.length > 0) {
          route4Polyline = L.polyline(route4Points, {
            color: '#000080',
            weight: 5,
            opacity: 0.6,
            smoothFactor: 1
          }).addTo(map)
			.on('click', function(e) {
		      selectRoute('4');
			});
		  
		  // 添加起点和终点标记
          if (route4Points.length > 1) {
            startMarker4 = L.marker(route4Points[0], {
              title: '路线4起点',
              opacity: 0
            }).bindPopup('2024年10月27日骑行起点').addTo(map);
            
            endMarker4 = L.marker(route4Points[route4Points.length-1], {
              title: '路线4终点',
              opacity: 0
            }).bindPopup('2024年10月27日骑行终点').addTo(map);
          }
        }
      })
      .on('error', function(e) {
        console.error('KML 4 error:', e);
      });
	  
	// 加载第五个KML文件
    var kmlLayer5 = omnivore.kml('https://raw.githubusercontent.com/qiuqiu-22/KMLRouteMap/refs/heads/main/KMLFile/20241102%E6%88%B7%E5%A4%96%E9%AA%91%E8%A1%8C.kml')
      .on('ready', function() {
        console.log('KML 5 loaded!');
        
        // 收集所有点坐标
        this.eachLayer(function(layer) {
          if (layer instanceof L.Marker) {
            route5Points.push(layer.getLatLng());
          }
        });
        
        // 创建折线
        if (route5Points.length > 0) {
          route5Polyline = L.polyline(route5Points, {
            color: '#00FFFF',
            weight: 5,
            opacity: 0.6,
            smoothFactor: 1
          }).addTo(map)
			.on('click', function(e) {
		      selectRoute('5');
			});
			
		  // 添加起点和终点标记
          if (route5Points.length > 1) {
            startMarker5 = L.marker(route5Points[0], {
              title: '路线5起点',
              opacity: 0
            }).bindPopup('2024年11月02日骑行起点').addTo(map);
            
            endMarker5 = L.marker(route5Points[route5Points.length-1], {
              title: '路线5终点',
              opacity: 0
            }).bindPopup('2024年11月02日骑行终点').addTo(map);
          }
        }
      })
      .on('error', function(e) {
        console.error('KML 5 error:', e);
      });
	  
	// 加载第六个KML文件
    var kmlLayer6 = omnivore.kml('https://raw.githubusercontent.com/qiuqiu-22/KMLRouteMap/refs/heads/main/KMLFile/20250301%E6%88%B7%E5%A4%96%E9%AA%91%E8%A1%8C.kml')
      .on('ready', function() {
        console.log('KML 6 loaded!');
        
        // 收集所有点坐标
        this.eachLayer(function(layer) {
          if (layer instanceof L.Marker) {
            route6Points.push(layer.getLatLng());
          }
        });
        
        // 创建折线
        if (route6Points.length > 0) {
          route6Polyline = L.polyline(route6Points, {
            color: '#3CB371',
            weight: 5,
            opacity: 0.6,
            smoothFactor: 1
          }).addTo(map)
			.on('click', function(e) {
		      selectRoute('6');
			});
			
		  // 添加起点和终点标记
          if (route6Points.length > 1) {
            startMarker6 = L.marker(route6Points[0], {
              title: '路线6起点',
              opacity: 0
            }).bindPopup('2025年03月01日骑行起点').addTo(map);
            
            endMarker6 = L.marker(route6Points[route6Points.length-1], {
              title: '路线6终点',
              opacity: 0
            }).bindPopup('2025年03月01日骑行终点').addTo(map);
          }
        }
      })
      .on('error', function(e) {
        console.error('KML 6 error:', e);
      });
	  
	// 加载第七个KML文件
    var kmlLayer7 = omnivore.kml('https://raw.githubusercontent.com/qiuqiu-22/KMLRouteMap/refs/heads/main/KMLFile/20250322%E6%88%B7%E5%A4%96%E9%AA%91%E8%A1%8C.kml')
      .on('ready', function() {
        console.log('KML 7 loaded!');
        
        // 收集所有点坐标
        this.eachLayer(function(layer) {
          if (layer instanceof L.Marker) {
            route7Points.push(layer.getLatLng());
          }
        });
        
        // 创建折线
        if (route7Points.length > 0) {
          route7Polyline = L.polyline(route7Points, {
            color: '#DAA520',
            weight: 5,
            opacity: 0.6,
            smoothFactor: 1
          }).addTo(map)
			.on('click', function(e) {
		      selectRoute('7');
			});
			
		  // 添加起点和终点标记
          if (route7Points.length > 1) {
            startMarker7 = L.marker(route7Points[0], {
              title: '路线7起点',
              opacity: 0
            }).bindPopup('2025年03月22日骑行起点').addTo(map);
            
            endMarker7 = L.marker(route7Points[route7Points.length-1], {
              title: '路线7终点',
              opacity: 0
            }).bindPopup('2025年03月22日骑行终点').addTo(map);
          }
        }
      })
      .on('error', function(e) {
        console.error('KML 7 error:', e);
      });
	  
	// 加载第八个KML文件
    var kmlLayer8 = omnivore.kml('https://raw.githubusercontent.com/qiuqiu-22/KMLRouteMap/refs/heads/main/KMLFile/20250325%E6%88%B7%E5%A4%96%E9%AA%91%E8%A1%8C.kml')
      .on('ready', function() {
        console.log('KML 8 loaded!');
        
        // 收集所有点坐标
        this.eachLayer(function(layer) {
          if (layer instanceof L.Marker) {
            route8Points.push(layer.getLatLng());
          }
        });
        
        // 创建折线
        if (route8Points.length > 0) {
          route8Polyline = L.polyline(route8Points, {
            color: '#FF4500',
            weight: 5,
            opacity: 0.6,
            smoothFactor: 1
          }).addTo(map)
			.on('click', function(e) {
		      selectRoute('8');
			});
			
		  // 添加起点和终点标记
          if (route8Points.length > 1) {
            startMarker8 = L.marker(route8Points[0], {
              title: '路线8起点',
              opacity: 0
            }).bindPopup('2025年03月25日骑行起点').addTo(map);
            
            endMarker8 = L.marker(route8Points[route8Points.length-1], {
              title: '路线8终点',
              opacity: 0
            }).bindPopup('2025年03月25日骑行终点').addTo(map);
          }
        }
      })
      .on('error', function(e) {
        console.error('KML 8 error:', e);
      });
	  
	// 加载第九个KML文件
    var kmlLayer9 = omnivore.kml('https://raw.githubusercontent.com/qiuqiu-22/KMLRouteMap/refs/heads/main/KMLFile/20250603%E6%88%B7%E5%A4%96%E9%AA%91%E8%A1%8C.kml')
      .on('ready', function() {
        console.log('KML 9 loaded!');
        
        // 收集所有点坐标
        this.eachLayer(function(layer) {
          if (layer instanceof L.Marker) {
            route9Points.push(layer.getLatLng());
          }
        });
        
        // 创建折线
        if (route9Points.length > 0) {
          route9Polyline = L.polyline(route9Points, {
            color: '#8B0000',
            weight: 5,
            opacity: 0.6,
            smoothFactor: 1
          }).addTo(map)
			.on('click', function(e) {
		      selectRoute('9');
			});
			
		  // 添加起点和终点标记
          if (route9Points.length > 1) {
            startMarker9 = L.marker(route9Points[0], {
              title: '路线9起点',
              opacity: 0
            }).bindPopup('2025年06月03日骑行起点').addTo(map);
            
            endMarker9 = L.marker(route9Points[route9Points.length-1], {
              title: '路线9终点',
              opacity: 0
            }).bindPopup('2025年06月03日骑行终点').addTo(map);
          }
        }
      })
      .on('error', function(e) {
        console.error('KML 9 error:', e);
      });
	  
	// 加载第十个KML文件
    var kmlLayer10 = omnivore.kml('https://raw.githubusercontent.com/qiuqiu-22/KMLRouteMap/refs/heads/main/KMLFile/20250605%E6%88%B7%E5%A4%96%E9%AA%91%E8%A1%8C.kml')
      .on('ready', function() {
        console.log('KML 10 loaded!');
        
        // 收集所有点坐标
        this.eachLayer(function(layer) {
          if (layer instanceof L.Marker) {
            route10Points.push(layer.getLatLng());
          }
        });
        
        // 创建折线
        if (route10Points.length > 0) {
          route10Polyline = L.polyline(route10Points, {
            color: '#8B2070',
            weight: 5,
            opacity: 0.6,
            smoothFactor: 1
          }).addTo(map)
			.on('click', function(e) {
		      selectRoute('10');
			});
			
		  // 添加起点和终点标记
          if (route10Points.length > 1) {
            startMarker10 = L.marker(route10Points[0], {
              title: '路线10起点',
              opacity: 0
            }).bindPopup('2025年06月05日骑行起点').addTo(map);
            
            endMarker10 = L.marker(route10Points[route10Points.length-1], {
              title: '路线10终点',
              opacity: 0
            }).bindPopup('2025年06月05日骑行终点').addTo(map);
          }
        }
      })
      .on('error', function(e) {
        console.error('KML 10 error:', e);
      });
	  
	function selectRoute(routeId) {
      // 重置所有路线样式
      resetAllRoutes();
      // 更新选中路线
      selectedRoute = routeId;
      // 高亮显示
	  highlightRoute(routeId);      
      }
	
	// 重置所有路线到默认状态
    function resetAllRoutes() {
      if (route1Polyline) {
		route1Polyline.setStyle({ weight: 5, opacity: 0.6 });
		startMarker1.setOpacity(0);
		endMarker1.setOpacity(0);
	  }
      if (route2Polyline) {
		route2Polyline.setStyle({ weight: 5, opacity: 0.6 });
		startMarker2.setOpacity(0);
		endMarker2.setOpacity(0);
	  }
      if (route3Polyline) {
		route3Polyline.setStyle({ weight: 5, opacity: 0.6 });
		startMarker3.setOpacity(0);
		endMarker3.setOpacity(0);
	  }
      if (route4Polyline) {
		route4Polyline.setStyle({ weight: 5, opacity: 0.6 });
		startMarker4.setOpacity(0);
		endMarker4.setOpacity(0);
	  }
      if (route5Polyline) {
		route5Polyline.setStyle({ weight: 5, opacity: 0.6 });
		startMarker5.setOpacity(0);
		endMarker5.setOpacity(0);
	  }
      if (route6Polyline) {
		route6Polyline.setStyle({ weight: 5, opacity: 0.6 });
		startMarker6.setOpacity(0);
		endMarker6.setOpacity(0);
	  }
      if (route7Polyline) {
		route7Polyline.setStyle({ weight: 5, opacity: 0.6 });
		startMarker7.setOpacity(0);
		endMarker7.setOpacity(0);
	  }
      if (route8Polyline) {
		route8Polyline.setStyle({ weight: 5, opacity: 0.6 });
		startMarker8.setOpacity(0);
		endMarker8.setOpacity(0);
	  }
      if (route9Polyline) {
		route9Polyline.setStyle({ weight: 5, opacity: 0.6 });
		startMarker9.setOpacity(0);
		endMarker9.setOpacity(0);
	  }
	  if (route10Polyline) {
		route10Polyline.setStyle({ weight: 5, opacity: 0.6 });
		startMarker10.setOpacity(0);
		endMarker10.setOpacity(0);
	  }
    }
    
    // 加粗显示选中的路线
    function highlightRoute(routeId) {
	  
      selectedRoute = routeId;
      
      switch(routeId) {
        case '1':
          if (route1Polyline) {
			route1Polyline.setStyle({ weight: 8, opacity: 1 });
			startMarker1.setOpacity(1);
			endMarker1.setOpacity(1);
		  }
          break;
        case '2':
          if (route2Polyline) {
			route2Polyline.setStyle({ weight: 8, opacity: 1 });
			startMarker2.setOpacity(1);
			endMarker2.setOpacity(1);
		  }
          break;
        case '3':
          if (route3Polyline) {
			route3Polyline.setStyle({ weight: 8, opacity: 1 });
			startMarker3.setOpacity(1);
			endMarker3.setOpacity(1);
		  }
          break;
        case '4':
          if (route4Polyline) {
			route4Polyline.setStyle({ weight: 8, opacity: 1 });
			startMarker4.setOpacity(1);
			endMarker4.setOpacity(1);
		  }
          break;
        case '5':
          if (route5Polyline) {
			route5Polyline.setStyle({ weight: 8, opacity: 1 });
			startMarker5.setOpacity(1);
			endMarker5.setOpacity(1);
		  }
          break;
        case '6':
          if (route6Polyline) {
			route6Polyline.setStyle({ weight: 8, opacity: 1 });
			startMarker6.setOpacity(1);
			endMarker6.setOpacity(1);
		  }
          break;
        case '7':
          if (route7Polyline) {
			route7Polyline.setStyle({ weight: 8, opacity: 1 });
			startMarker7.setOpacity(1);
			endMarker7.setOpacity(1);
		  }
          break;
        case '8':
          if (route8Polyline) {
			route8Polyline.setStyle({ weight: 8, opacity: 1 });
			startMarker8.setOpacity(1);
			endMarker8.setOpacity(1);
		  }
          break;
        case '9':
          if (route9Polyline) {
			route9Polyline.setStyle({ weight: 8, opacity: 1 });
			startMarker9.setOpacity(1);
			endMarker9.setOpacity(1);
		  }
          break;
		case '10':
          if (route10Polyline) {
			route10Polyline.setStyle({ weight: 8, opacity: 1 });
			startMarker10.setOpacity(1);
			endMarker10.setOpacity(1);
		  }
          break;
      }
    }
	
  </script>
</body>
</html>
